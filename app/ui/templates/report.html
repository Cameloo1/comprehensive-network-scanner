<!doctype html><html><head><meta charset="utf-8"><title>Scan Report {{ scan.id }}</title>
<style>
body{font-family:system-ui,Arial;margin:2rem}
h1,h2{margin:.2rem 0} table{border-collapse:collapse;width:100%}
.host-header{font-size:1.3em;font-weight:bold}
th,td{border:1px solid #ddd;padding:.4rem} .badge{padding:.2rem .5rem;border-radius:.3rem}
.critical{background:#5c0000;color:#fff}.high{background:#9b1c1c;color:#fff}
.medium{background:#b7791f;color:#fff}.low{background:#2b6cb0;color:#fff}.info{background:#4a5568;color:#fff}
</style></head><body>
<h1>External Vulnerability Assessment</h1>
<p><strong>Scan ID:</strong> {{ scan.id }} | <strong>Target:</strong> {{ scan.target }} | <strong>Safe Mode:</strong> {{ scan.safe_mode }}</p>

<h2>Executive Summary</h2>
<p>
  <span class="badge high">High: {{ totals.high }}</span>
  <span class="badge medium">Medium: {{ totals.medium }}</span>
  <span class="badge low">Low: {{ totals.low }}</span>
  <span class="badge info">Info: {{ totals.info }}</span>
</p>

<h2>Target IPs Scanned</h2>
<table><thead><tr><th>IP Address</th><th>Reverse DNS</th><th>Ports Found</th><th>Findings</th></tr></thead><tbody>
{% for h in hosts %}
<tr>
  <td>{{ h.ip }}</td>
  <td>{{ h.rdns or 'No RDNS' }}</td>
  <td>
    {% set total_ports = h.ports|length %}
    {% set open_ports = h.ports|selectattr('state', 'equalto', 'open')|list|length %}
    {% if total_ports > 0 %}
      {{ total_ports }} total ({{ open_ports }} open)
    {% else %}
      No ports found
    {% endif %}
  </td>
  <td>
    {% set findings_count = h.findings|length %}
    {% if findings_count > 0 %}
      {{ findings_count }} findings
    {% else %}
      No findings
    {% endif %}
  </td>
</tr>
{% endfor %}
</tbody></table>

{% for h in hosts %}
<h2 class="host-header">Host: {{ h.ip }} {% if h.rdns %}({{ h.rdns }}){% endif %}</h2>

<h3>Port Scan Results</h3>
<table><thead><tr><th>Port</th><th>Protocol</th><th>Service</th><th>Version</th><th>State</th></tr></thead><tbody>
{% if h.ports %}
{% for p in h.ports %}
<tr>
  <td>{{ p.port }}</td>
  <td>{{ p.proto }}</td>
  <td>{{ p.service or 'unknown' }}</td>
  <td>{{ p.version or 'N/A' }}</td>
  <td><span class="badge {% if p.state == 'open' %}high{% elif p.state == 'closed' %}medium{% elif p.state == 'filtered' %}low{% else %}info{% endif %}">{{ p.state }}</span></td>
</tr>
{% endfor %}
{% else %}
<tr><td colspan="5">No ports found</td></tr>
{% endif %}
</tbody></table>

{% if h.whois and h.whois.network %}
<h3>WHOIS Information</h3>
<table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>
<tr><td><strong>Organization</strong></td><td>{{ h.whois.network.name or 'N/A' }}</td></tr>
<tr><td><strong>ASN</strong></td><td>{{ h.whois.asn or 'N/A' }} ({{ h.whois.asn_description or 'N/A' }})</td></tr>
<tr><td><strong>Country</strong></td><td>{{ h.whois.asn_country_code or 'N/A' }}</td></tr>
<tr><td><strong>CIDR</strong></td><td>{{ h.whois.asn_cidr or 'N/A' }}</td></tr>
<tr><td><strong>Network Range</strong></td><td>{{ h.whois.network.start_address or 'N/A' }} - {{ h.whois.network.end_address or 'N/A' }}</td></tr>
{% if h.whois.objects %}
{% for obj_key, obj in h.whois.objects.items() %}
{% if obj.contact %}
<tr><td><strong>Contact ({{ obj_key }})</strong></td><td>{{ obj.contact.name or 'N/A' }}</td></tr>
{% if obj.contact.email %}
<tr><td><strong>Email ({{ obj_key }})</strong></td><td>{{ obj.contact.email[0].value if obj.contact.email else 'N/A' }}</td></tr>
{% endif %}
{% if obj.contact.phone %}
<tr><td><strong>Phone ({{ obj_key }})</strong></td><td>{{ obj.contact.phone[0].value if obj.contact.phone else 'N/A' }}</td></tr>
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
</tbody></table>
{% endif %}

{% if h.web_targets %}
<h3>Web Application Fingerprinting</h3>
<table><thead><tr><th>URL</th><th>Technologies Detected</th></tr></thead><tbody>
{% for wt in h.web_targets %}
<tr>
  <td>{{ wt.url }}</td>
  <td>
    {% if wt.fingerprint.plugins %}
      {% for plugin in wt.fingerprint.plugins %}{{ plugin }}{% if not loop.last %}, {% endif %}{% endfor %}
    {% else %}
      Basic HTTP response ({{ wt.fingerprint.get('status_code', 'N/A') }})
    {% endif %}
  </td>
</tr>
{% endfor %}
</tbody></table>
{% endif %}

<h3>TLS/SSL Analysis</h3>
<table><thead><tr><th>Tool</th><th>Status</th><th>Details</th></tr></thead><tbody>
<tr>
  <td><strong>SSLyze</strong></td>
  <td>
    {% if h.tls.sslyze and not h.tls.sslyze.error %}
      <span class="badge high">Success</span>
    {% else %}
      <span class="badge info">Failed</span>
    {% endif %}
  </td>
  <td>
    {% if h.tls.sslyze and not h.tls.sslyze.error %}
      {% if h.tls.sslyze.certificate_subject %}Subject: {{ h.tls.sslyze.certificate_subject[:50] }}...{% endif %}
      {% if h.tls.sslyze.supported_tls_versions %} | TLS: {{ h.tls.sslyze.supported_tls_versions|join(', ') }}{% endif %}
      {% if h.tls.sslyze.total_cipher_suites %} | Ciphers: {{ h.tls.sslyze.total_cipher_suites }}{% endif %}
    {% else %}
      {{ h.tls.sslyze.error if h.tls.sslyze else 'Not performed' }}
    {% endif %}
  </td>
</tr>
<tr>
  <td><strong>TestSSL</strong></td>
  <td>
    {% if h.tls.testssl_json %}
      <span class="badge high">Success</span>
    {% else %}
      <span class="badge info">Not performed</span>
    {% endif %}
  </td>
  <td>
    {% if h.tls.testssl_json %}
      TLS configuration analyzed (detailed data available)
    {% else %}
      No open HTTPS ports or tool failed
    {% endif %}
  </td>
</tr>
<tr>
  <td><strong>Target Ports</strong></td>
  <td>
    {% if h.tls.open_ports %}
      <span class="badge high">Found</span>
    {% else %}
      <span class="badge info">None</span>
    {% endif %}
  </td>
  <td>
    {% if h.tls.open_ports %}
      Analyzed: {% for port in h.tls.open_ports %}{{ port.port }}/{{ port.service }}{% if not loop.last %}, {% endif %}{% endfor %}
    {% else %}
      No open HTTPS ports found for analysis
    {% endif %}
  </td>
</tr>
</tbody></table>

<h3>Vulnerability Findings</h3>
<table><thead><tr><th>Severity</th><th>Source</th><th>Title</th><th>Evidence</th><th>Fix</th></tr></thead><tbody>
{% for f in h.findings %}
<tr>
  <td><span class="badge {{ f.severity }}">{{ f.severity|capitalize }}</span></td>
  <td><span class="badge info">{{ f.source|upper }}</span></td>
  <td>{{ f.name }}</td>
  <td>{{ f.evidence }}</td>
  <td>{{ f.remediation }}</td>
</tr>
{% else %}
<tr><td colspan="5">No findings.</td></tr>
{% endfor %}
</tbody></table>
{% endfor %}

<h2>Recommendations</h2>
<ul>
  <li>Patch or update services with High findings first; verify exposure is minimized.</li>
  <li>Harden TLS (disable weak protocols/ciphers; renew expired certs).</li>
  <li>Remove unnecessary open ports; restrict admin panels.</li>
</ul>
</body></html>
